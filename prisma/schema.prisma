
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AdminUser {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  createdAt    DateTime @default(now())
}

model Product {
  id          String   @id @default(uuid())
  name        String
  category    String // Panini, Menu, Bevande, Extra
  topic       String? // e.g., "Salse", "Bevande", "Extra"
  priceCents  Int
  description String?
  allergens   String?
  isAvailable Boolean  @default(true)
  stock       Int? // Optional stock tracking
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  OrderItems  OrderItem[]
  options     ProductOption[]
}

model ProductOption {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String  // e.g., "Salse"
  choices   String  // Comma separated, e.g., "Ketchup, Maionese, Senape"
  allowMulti Boolean @default(true)
}

model ShopOrder {
  id           String      @id @default(uuid())
  createdAt    DateTime    @default(now())
  status       String // PAID, IN_PREPARATION, READY, DELIVERED, CANCELLED
  pickupCode   String // 4-digit code
  studentName  String
  studentClass String
  note         String?
  totalCents   Int
  items        OrderItem[]
  printJob     PrintJob?

  @@map("Order")
}

model OrderItem {
  id                 String  @id @default(uuid())
  orderId            String
  order              ShopOrder @relation(fields: [orderId], references: [id])
  productId          String?
  product            Product?   @relation(fields: [productId], references: [id], onDelete: SetNull)
  nameSnapshot       String
  priceCentsSnapshot Int
  qty                Int
  topicSnapshot      String? // Snapshot of product topic
  selectedOptions    String? // e.g., "Salse: Ketchup, Maionese"
}

model Settings {
  id                   Int     @id @default(1)
  cutoffTime           String  @default("10:00")
  orderingEnabled      Boolean @default(true)
  lifetimeRevenueCents Int     @default(0)
}

model PrintJob {
  id          String   @id @default(uuid())
  orderId     String   @unique
  order       ShopOrder @relation(fields: [orderId], references: [id])
  createdAt   DateTime @default(now())
  status      String   @default("QUEUED") // QUEUED, PRINTED
  payloadText String
}
